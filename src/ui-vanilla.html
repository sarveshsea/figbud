<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    /* Once UI Design System - Vanilla CSS */
    :root {
      /* Colors */
      --background: #0A0A0A;
      --surface: #1A1A1A;
      --surface-elevated: #252525;
      --primary: #6366F1;
      --primary-hover: #5558E8;
      --primary-active: #4A4DDF;
      --text: #E5E5E5;
      --text-muted: #999999;
      --border: rgba(255, 255, 255, 0.1);
      --shadow: 0 0 0 1px rgba(255, 255, 255, 0.05), 0 2px 4px rgba(0, 0, 0, 0.2);
      
      /* Spacing */
      --space-xs: 4px;
      --space-s: 8px;
      --space-m: 16px;
      --space-l: 24px;
      --space-xl: 32px;
      
      /* Radius */
      --radius-s: 6px;
      --radius-m: 8px;
      --radius-l: 12px;
      --radius-xl: 16px;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      background: var(--background);
      color: var(--text);
      padding: var(--space-m);
      line-height: 1.5;
    }
    
    /* Typography */
    h1, h2, h3 {
      font-weight: 600;
      line-height: 1.2;
    }
    
    h1 {
      font-size: 24px;
      margin-bottom: var(--space-l);
    }
    
    h2 {
      font-size: 18px;
      margin-bottom: var(--space-m);
    }
    
    h3 {
      font-size: 16px;
      margin-bottom: var(--space-s);
    }
    
    /* Card Component */
    .card {
      background: var(--surface);
      border-radius: var(--radius-l);
      padding: var(--space-l);
      margin-bottom: var(--space-m);
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
    
    .card-elevated {
      background: var(--surface-elevated);
    }
    
    /* Button Component */
    .btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: var(--space-s) var(--space-m);
      border-radius: var(--radius-m);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-s);
      min-height: 40px;
    }
    
    .btn:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
    }
    
    .btn:active {
      background: var(--primary-active);
      transform: translateY(0);
    }
    
    .btn-full {
      width: 100%;
    }
    
    .btn-secondary {
      background: var(--surface-elevated);
      color: var(--text);
      border: 1px solid var(--border);
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    /* Input Component */
    .input-group {
      margin-bottom: var(--space-m);
    }
    
    .input-label {
      display: block;
      margin-bottom: var(--space-xs);
      color: var(--text-muted);
      font-size: 12px;
      font-weight: 500;
    }
    
    .input {
      width: 100%;
      padding: var(--space-s) var(--space-m);
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-m);
      color: var(--text);
      font-size: 14px;
      transition: all 0.2s ease;
      outline: none;
    }
    
    .input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
    }
    
    /* Badge Component */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: var(--space-xs) var(--space-s);
      background: rgba(99, 102, 241, 0.1);
      color: var(--primary);
      border-radius: var(--radius-s);
      font-size: 12px;
      font-weight: 500;
    }
    
    /* Flex Layout */
    .flex {
      display: flex;
    }
    
    .flex-col {
      flex-direction: column;
    }
    
    .flex-between {
      justify-content: space-between;
      align-items: center;
    }
    
    .flex-center {
      justify-content: center;
      align-items: center;
    }
    
    .gap-s { gap: var(--space-s); }
    .gap-m { gap: var(--space-m); }
    .gap-l { gap: var(--space-l); }
    
    /* Grid Layout */
    .grid {
      display: grid;
      gap: var(--space-m);
    }
    
    .grid-2 {
      grid-template-columns: repeat(2, 1fr);
    }
    
    /* Chat Interface */
    .chat-container {
      height: 400px;
      display: flex;
      flex-direction: column;
    }
    
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: var(--space-m);
      background: var(--background);
      border-radius: var(--radius-m);
      margin-bottom: var(--space-m);
    }
    
    .message {
      padding: var(--space-s) var(--space-m);
      border-radius: var(--radius-m);
      margin-bottom: var(--space-s);
      max-width: 80%;
    }
    
    .message-user {
      background: var(--primary);
      color: white;
      margin-left: auto;
      text-align: right;
    }
    
    .message-bot {
      background: var(--surface-elevated);
      color: var(--text);
    }
    
    /* Sandbox Area */
    .sandbox-area {
      background: rgba(59, 130, 246, 0.03);
      border: 2px dashed rgba(59, 130, 246, 0.2);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .sandbox-area:hover {
      background: rgba(59, 130, 246, 0.05);
      border-color: rgba(59, 130, 246, 0.3);
    }
    
    /* Chips */
    .chip-container {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-s);
      margin-bottom: var(--space-m);
    }
    
    .chip {
      padding: var(--space-xs) var(--space-m);
      background: var(--surface-elevated);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .chip:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    /* Status Message */
    .status {
      color: var(--text-muted);
      font-size: 12px;
      text-align: center;
      padding: var(--space-s);
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      background: var(--surface);
      padding: var(--space-xs);
      border-radius: var(--radius-m);
      margin-bottom: var(--space-m);
    }
    
    .tab {
      flex: 1;
      padding: var(--space-s) var(--space-m);
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      border-radius: var(--radius-s);
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
    }
    
    .tab.active {
      background: var(--surface-elevated);
      color: var(--text);
    }
    
    /* Loading Spinner */
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--background);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--surface-elevated);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--border);
    }
    
    /* Utilities */
    .hidden { display: none; }
    .text-muted { color: var(--text-muted); }
    .text-small { font-size: 12px; }
    .mb-s { margin-bottom: var(--space-s); }
    .mb-m { margin-bottom: var(--space-m); }
    .mb-l { margin-bottom: var(--space-l); }
  </style>
</head>
<body>
  <!-- Main Container -->
  <div id="app">
    <!-- Header -->
    <div class="flex flex-between mb-m">
      <h1>ü§ñ FigBud</h1>
      <div class="badge">AI Assistant</div>
    </div>
    
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('chat')">Chat</button>
      <button class="tab" onclick="switchTab('create')">Create</button>
      <button class="tab" onclick="switchTab('sandbox')">Sandbox</button>
    </div>
    
    <!-- Chat View -->
    <div id="chat-view" class="view">
      <div class="card chat-container">
        <div class="chat-messages" id="chat-messages">
          <div class="message message-bot">
            Hi! I'm FigBud, your AI-powered Figma assistant. How can I help you design today?
          </div>
        </div>
        
        <div class="chip-container">
          <div class="chip" onclick="sendQuickMessage('Create a button')">Create a button</div>
          <div class="chip" onclick="sendQuickMessage('Make a card component')">Make a card</div>
          <div class="chip" onclick="sendQuickMessage('Design a form')">Design a form</div>
          <div class="chip" onclick="sendQuickMessage('Build a navbar')">Build a navbar</div>
        </div>
        
        <div class="input-group">
          <input 
            type="text" 
            class="input" 
            id="chat-input" 
            placeholder="Ask me anything..."
            onkeypress="handleChatKeypress(event)"
          />
        </div>
      </div>
    </div>
    
    <!-- Create View -->
    <div id="create-view" class="view hidden">
      <div class="card">
        <h2>Quick Create</h2>
        <p class="text-muted mb-m">Create beautiful UI components instantly</p>
        
        <div class="grid grid-2 gap-m">
          <button class="btn btn-full" onclick="createComponent('button')">
            <span>üì±</span> Button
          </button>
          <button class="btn btn-full" onclick="createComponent('card')">
            <span>üóÇ</span> Card
          </button>
          <button class="btn btn-full" onclick="createComponent('input')">
            <span>‚úèÔ∏è</span> Input
          </button>
          <button class="btn btn-full" onclick="createComponent('navbar')">
            <span>üß≠</span> Navbar
          </button>
        </div>
      </div>
      
      <div class="card">
        <h3>Recent Components</h3>
        <div id="recent-components" class="flex flex-col gap-s">
          <p class="text-muted text-small">No components created yet</p>
        </div>
      </div>
    </div>
    
    <!-- Sandbox View -->
    <div id="sandbox-view" class="view hidden">
      <div class="card">
        <h2>Component Sandbox</h2>
        <p class="text-muted mb-m">Practice creating and customizing components</p>
        
        <div class="sandbox-area">
          <h3>Drop components here</h3>
          <p class="text-muted mb-m">This is your practice area</p>
          <button class="btn" onclick="startSandboxTutorial()">
            Start Tutorial
          </button>
        </div>
      </div>
    </div>
    
    <!-- Status Bar -->
    <div class="status" id="status">Ready</div>
  </div>
  
  <script>
    // State Management
    const state = {
      currentTab: 'chat',
      messages: [],
      recentComponents: [],
      isLoading: false
    };
    
    // Initialize
    function init() {
      console.log('[FigBud] Initializing...');
      updateStatus('Connected to Figma');
      
      // Listen for messages from Figma
      window.onmessage = handleFigmaMessage;
    }
    
    // Tab Switching
    function switchTab(tab) {
      state.currentTab = tab;
      
      // Update tab buttons
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      
      // Show/hide views
      document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
      document.getElementById(`${tab}-view`).classList.remove('hidden');
    }
    
    // Chat Functions
    function handleChatKeypress(event) {
      if (event.key === 'Enter' && !state.isLoading) {
        const input = event.target;
        const message = input.value.trim();
        if (message) {
          sendMessage(message);
          input.value = '';
        }
      }
    }
    
    function sendQuickMessage(message) {
      sendMessage(message);
    }
    
    function sendMessage(message) {
      // Add user message
      addMessage(message, 'user');
      
      // Process the message
      processUserMessage(message);
    }
    
    function addMessage(text, sender) {
      const messagesDiv = document.getElementById('chat-messages');
      const messageEl = document.createElement('div');
      messageEl.className = `message message-${sender}`;
      messageEl.textContent = text;
      messagesDiv.appendChild(messageEl);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      
      // Save to state
      state.messages.push({ text, sender, timestamp: Date.now() });
    }
    
    function processUserMessage(message) {
      const lower = message.toLowerCase();
      
      // Show loading
      state.isLoading = true;
      updateStatus('Processing...');
      
      // Simulate AI processing
      setTimeout(() => {
        let response = '';
        let action = null;
        
        if (lower.includes('button')) {
          response = "I'll create a beautiful button component for you!";
          action = { type: 'create-component', component: 'button' };
        } else if (lower.includes('card')) {
          response = "Creating a card component with Once UI styling!";
          action = { type: 'create-component', component: 'card' };
        } else if (lower.includes('input') || lower.includes('form')) {
          response = "I'll design a form input for you!";
          action = { type: 'create-component', component: 'input' };
        } else if (lower.includes('navbar') || lower.includes('navigation')) {
          response = "Creating a navigation bar component!";
          action = { type: 'create-component', component: 'navbar' };
        } else {
          response = "I can help you create UI components! Try asking me to create a button, card, input, or navbar.";
        }
        
        addMessage(response, 'bot');
        
        if (action) {
          sendToFigma(action);
        }
        
        state.isLoading = false;
        updateStatus('Ready');
      }, 500);
    }
    
    // Component Creation
    function createComponent(type) {
      updateStatus(`Creating ${type}...`);
      sendToFigma({
        type: 'create-component',
        component: type,
        props: getComponentProps(type)
      });
    }
    
    function getComponentProps(type) {
      switch (type) {
        case 'button':
          return { text: 'Click me', variant: 'primary' };
        case 'card':
          return { title: 'Card Title', description: 'Card description here' };
        case 'input':
          return { label: 'Email', placeholder: 'Enter your email' };
        case 'navbar':
          return { brand: 'FigBud', links: ['Home', 'About', 'Contact'] };
        default:
          return {};
      }
    }
    
    // Sandbox Functions
    function startSandboxTutorial() {
      addMessage("Starting sandbox tutorial! Let's create some components together.", 'bot');
      switchTab('chat');
    }
    
    // Communication with Figma
    function sendToFigma(message) {
      parent.postMessage({ pluginMessage: message }, '*');
    }
    
    function handleFigmaMessage(event) {
      const message = event.data.pluginMessage;
      if (!message) return;
      
      console.log('[FigBud] Received from Figma:', message);
      
      switch (message.type) {
        case 'component-created':
          handleComponentCreated(message);
          break;
        case 'error':
          updateStatus(`Error: ${message.error}`);
          break;
      }
    }
    
    function handleComponentCreated(message) {
      updateStatus(`${message.component} created!`);
      
      // Add to recent components
      state.recentComponents.unshift({
        type: message.component,
        timestamp: Date.now()
      });
      
      // Update UI
      updateRecentComponents();
      
      // Show success message
      setTimeout(() => updateStatus('Ready'), 2000);
    }
    
    function updateRecentComponents() {
      const container = document.getElementById('recent-components');
      if (state.recentComponents.length === 0) {
        container.innerHTML = '<p class="text-muted text-small">No components created yet</p>';
        return;
      }
      
      container.innerHTML = state.recentComponents
        .slice(0, 5)
        .map(comp => `
          <div class="flex flex-between">
            <span>${comp.type}</span>
            <span class="text-muted text-small">${formatTime(comp.timestamp)}</span>
          </div>
        `)
        .join('');
    }
    
    function formatTime(timestamp) {
      const diff = Date.now() - timestamp;
      if (diff < 60000) return 'Just now';
      if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
      return `${Math.floor(diff / 3600000)}h ago`;
    }
    
    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }
    
    // Start the app
    init();
  </script>
</body>
</html>